<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./style.css" />
    <script></script>

    <title>Document</title>
  </head>
  <body>
    <div id="sharepointTable"></div>
    <script>
      class SharePointTable {
        constructor({
          data = [],
          containerId,
          tableHeaderColors = "#f4f4f4",
          cellSize = "auto",
          outline = true,
          backgroundColor = "#fff",
          textColor = "#000",
          borderColor = "#ccc",
          customClass = "",
        }) {
          this.data = data;
          this.containerId = containerId;
          this.tableHeaderColors = tableHeaderColors;
          this.cellSize = cellSize;
          this.outline = outline;
          this.backgroundColor = backgroundColor;
          this.textColor = textColor;
          this.borderColor = borderColor;
          this.customClass = customClass;
        }

        // If data is SharePoint REST API format, flatten it
        _flattenSharePointData(raw) {
          if (!raw?.d?.results) return raw;
          return raw.d.results.map((item) => ({
            Id: item.Id,
            Title: item.Title,
            Author: item.Author?.Title ?? "",
            Modified: item.Modified,
            Created: item.Created,
            Status: item.Status,
          }));
        }

        // Generate table headers dynamically based on data keys
        _generateHeaders() {
          if (!this.data || this.data.length === 0) return [];
          return Object.keys(this.data[0]);
        }

        // Render the table
        render() {
          const container = document.getElementById(this.containerId);
          if (!container) {
            console.error(`Container with ID "${this.containerId}" not found.`);
            return;
          }

          // If it's raw SharePoint API data, flatten first
          if (this.data?.d?.results) {
            this.data = this._flattenSharePointData(this.data);
          }

          // Clear existing content
          container.innerHTML = "";

          const table = document.createElement("table");
          table.className = this.customClass;

          // Table styling
          table.style.width = "100%";
          table.style.borderCollapse = "collapse";
          table.style.backgroundColor = this.backgroundColor;
          table.style.color = this.textColor;

          // Headers
          const headers = this._generateHeaders();
          if (headers.length > 0) {
            const thead = document.createElement("thead");
            const headerRow = document.createElement("tr");

            headers.forEach((header) => {
              const th = document.createElement("th");
              th.innerText = header;
              th.style.backgroundColor = this.tableHeaderColors;
              th.style.padding = "8px";
              th.style.textAlign = "left";
              th.style.border = this.outline
                ? `1px solid ${this.borderColor}`
                : "none";
              th.style.minWidth = this.cellSize;
              headerRow.appendChild(th);
            });

            thead.appendChild(headerRow);
            table.appendChild(thead);
          }

          // Body
          const tbody = document.createElement("tbody");

          this.data.forEach((row) => {
            const tr = document.createElement("tr");

            headers.forEach((header) => {
              const td = document.createElement("td");
              td.innerText = row[header] ?? "";
              td.style.padding = "8px";
              td.style.border = this.outline
                ? `1px solid ${this.borderColor}`
                : "none";
              td.style.minWidth = this.cellSize;
              tr.appendChild(td);
            });

            tbody.appendChild(tr);
          });

          table.appendChild(tbody);
          container.appendChild(table);
        }
      }

      // Make it available globally
      window.SharePointTable = SharePointTable;
    </script>

    <script>
      // Mock SharePoint REST API response
      const sharepointApiResponse = {
        d: {
          results: [
            {
              Id: 1,
              Title: "Project Proposal",
              Author: { Title: "Alice Johnson" },
              Modified: "2025-08-01T09:12:00Z",
              Created: "2025-07-10T08:20:00Z",
              Status: "In Progress",
            },
            {
              Id: 2,
              Title: "Budget Report",
              Author: { Title: "Bob Smith" },
              Modified: "2025-08-02T14:45:00Z",
              Created: "2025-07-12T11:05:00Z",
              Status: "Approved",
            },
            {
              Id: 3,
              Title: "Meeting Notes",
              Author: { Title: "Charlie Brown" },
              Modified: "2025-08-03T10:22:00Z",
              Created: "2025-07-14T09:15:00Z",
              Status: "Draft",
            },
            {
              Id: 4,
              Title: "Risk Assessment",
              Author: { Title: "Dana White" },
              Modified: "2025-08-04T16:00:00Z",
              Created: "2025-07-15T13:30:00Z",
              Status: "Pending Review",
            },
            {
              Id: 5,
              Title: "Marketing Plan",
              Author: { Title: "Ethan Hunt" },
              Modified: "2025-08-05T08:45:00Z",
              Created: "2025-07-17T15:40:00Z",
              Status: "Approved",
            },
            // ...add more up to 20 rows
          ],
        },
      };

      // Create and render table
      const table = new SharePointTable({
        data: sharepointApiResponse, // can pass raw SharePoint API data
        containerId: "sharepointTable",
        tableHeaderColors: "#0078D4",
        cellSize: "120px",
        outline: true,
        backgroundColor: "#fafafa",
        textColor: "#333",
        borderColor: "#0078D4",
        customClass: "sp-table",
      });

      table.render();
    </script>
  </body>
</html>
